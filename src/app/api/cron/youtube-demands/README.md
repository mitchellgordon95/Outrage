# YouTube Demands Cron Job

This cron job fetches recent videos from specified YouTube channels, analyzes their content, and generates political demands based on the video content.

## Configuration

### Environment Variables

Add these to your `.env` file:

```env
# YouTube Data API v3 key (get from Google Cloud Console)
YOUTUBE_API_KEY=your_youtube_api_key

# Comma-separated list of YouTube channel IDs to monitor
YOUTUBE_CHANNELS=UC_CHANNEL_ID_1,UC_CHANNEL_ID_2

# Cron job authentication secret (auto-generated by Vercel)
CRON_SECRET=your_cron_secret
```

### Finding YouTube Channel IDs

1. Go to the YouTube channel page
2. View page source or look at the URL
3. The channel ID is in the format: `UC` followed by 22 characters
4. Example: `https://www.youtube.com/channel/UCuVgoagmU3hmfMwtxG9s4Sw`

## How It Works

1. **Fetch Videos**: Uses YouTube Data API v3 to get the 5 most recent videos from each configured channel
2. **Get Transcripts**: Attempts to fetch video captions/transcripts
3. **Analyze Content**: Uses AI to analyze video content and generate political demands
4. **Store Results**: Saves demands to the `youtube_demands` table with source metadata

## Schedule

The cron job runs every 6 hours (`0 */6 * * *` in cron syntax).

## Rate Limiting

- YouTube Data API has quotas (default 10,000 units/day)
- Each search request costs 100 units
- Each caption list request costs 50 units
- The cron job includes 1-second delays between video processing

## Database Schema

Run the SQL in `youtube_demands_schema.sql` to create the required table.

## Testing

You can manually trigger the cron job:

```bash
# Local testing
curl -X POST http://localhost:3000/api/cron/youtube-demands

# Production (requires authentication)
curl -X POST https://your-domain.com/api/cron/youtube-demands \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

## Transcript Limitations

The current implementation has limitations for transcript fetching:

1. **YouTube API v3 Limitation**: The API doesn't allow direct caption download without OAuth
2. **Current Fallback**: Uses video title and description when transcripts aren't available

### Production Solutions

For full transcript support, consider:

1. **OAuth Implementation**: Implement YouTube OAuth to download captions
2. **Third-party Services**: Use services like `youtube-transcript-api` Python library
3. **Web Scraping**: Parse captions from video page HTML (less reliable)
4. **YouTube API v3 Captions**: Use the captions.download endpoint with proper OAuth

## Monitoring

Check the Vercel Functions logs for cron job execution details:

```bash
vercel logs --filter youtube-demands
```

## Security

- The cron endpoint is protected by Vercel's cron authentication
- In production, only Vercel can call this endpoint
- Never expose your YouTube API key in client-side code